import dev.imabad.mlp.tasks.SingleOutputJar

plugins {
    id("dev.imabad.mlp") version("1.0.0-SNAPSHOT")
    id("fabric-loom") version("1.3-SNAPSHOT") apply(false)
    id("net.minecraftforge.gradle") version("6.0.+") apply(false)
    id("java")
}

java.toolchain.languageVersion = JavaLanguageVersion.of(17)

multiLoader.root() {
    minecraftVersion.set("1.20.1")
    modID.set("trenzalore")
    singleOutputJar.set(true)
    accessWidenerFile.set(project(":common").file("src/main/resources/${mod_id}.accesswidener"))
}

allprojects {
    def isSnapshot = providers.environmentVariable('SNAPSHOT').is("true")
    version = "${mod_version}+mc${minecraft_version}${isSnapshot ? '-SNAPSHOT' : ''}"
}
subprojects {
    apply plugin: 'dev.imabad.mlp'

    sourceSets.main.resources.srcDir 'src/generated/resources'

    base {
        archivesName = "${mod_name}-${project.name}"
    }

    repositories {
        maven {
            name = "Creeperhost"
            url = uri("https://maven.creeperhost.net/")
        }
    }
}

tasks.withType(SingleOutputJar.class) {
    getArchiveIdentifier().set("TrenzaloreML")
    getOutput().set(project.file("build/libs/Trenzalore-${project.version}.jar"))
}

